<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>SATP Protocol - Live Demonstration</title>
        <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
        <script src="https://cdn.tailwindcss.com"></script>
        <style>
            @keyframes pulse-ring {
                0% {
                    transform: scale(0.95);
                    opacity: 1;
                }
                50% {
                    transform: scale(1.05);
                    opacity: 0.7;
                }
                100% {
                    transform: scale(0.95);
                    opacity: 1;
                }
            }

            @keyframes message-fly {
                0% {
                    transform: translateX(0) scale(0.8);
                    opacity: 0;
                }
                50% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    transform: translateX(300px) scale(0.8);
                    opacity: 0;
                }
            }

            @keyframes message-fly-reverse {
                0% {
                    transform: translateX(300px) scale(0.8);
                    opacity: 0;
                }
                50% {
                    opacity: 1;
                    transform: scale(1);
                }
                100% {
                    transform: translateX(0) scale(0.8);
                    opacity: 0;
                }
            }

            .pulse-animation {
                animation: pulse-ring 2s ease-in-out infinite;
            }

            .message-packet {
                position: absolute;
                width: 40px;
                height: 40px;
                border-radius: 8px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                font-size: 12px;
                color: white;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            }

            .message-fly-right {
                animation: message-fly 1.5s ease-in-out;
            }

            .message-fly-left {
                animation: message-fly-reverse 1.5s ease-in-out;
            }

            .security-badge {
                transition: all 0.3s ease;
            }

            .event-item {
                animation: slideIn 0.3s ease-out;
            }

            @keyframes slideIn {
                from {
                    transform: translateX(-20px);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            .gradient-bg {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }

            .glass-effect {
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }
        </style>
    </head>
    <body class="bg-gray-900 text-white min-h-screen">
        <!-- Header -->
        <header class="gradient-bg shadow-lg">
            <div class="container mx-auto px-4 py-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold">üîê SATP Protocol</h1>
                        <p class="text-sm opacity-90">
                            Secure Assistive Transport Protocol - Live Demo
                        </p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm opacity-90">
                            Astana IT University
                        </div>
                        <div class="text-xs opacity-75">
                            Research Project 2025
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <div class="container mx-auto px-4 py-8">
            <!-- Status Bar -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                <!-- Connection Status -->
                <div class="bg-gray-800 rounded-lg p-4 shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm text-gray-400">Connection</div>
                            <div
                                id="connection-status"
                                class="text-xl font-bold text-red-500"
                            >
                                Disconnected
                            </div>
                        </div>
                        <div
                            id="connection-icon"
                            class="w-12 h-12 bg-red-500 rounded-full"
                        ></div>
                    </div>
                </div>

                <!-- Battery Level -->
                <div class="bg-gray-800 rounded-lg p-4 shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm text-gray-400">Battery</div>
                            <div id="battery-level" class="text-xl font-bold">
                                100%
                            </div>
                        </div>
                        <div class="text-4xl">üîã</div>
                    </div>
                    <div
                        class="mt-2 bg-gray-700 h-2 rounded-full overflow-hidden"
                    >
                        <div
                            id="battery-bar"
                            class="bg-green-500 h-full transition-all duration-500"
                            style="width: 100%"
                        ></div>
                    </div>
                </div>

                <!-- Security Level -->
                <div class="bg-gray-800 rounded-lg p-4 shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm text-gray-400">Security</div>
                            <div
                                id="security-level"
                                class="text-xl font-bold text-blue-500"
                            >
                                BALANCED
                            </div>
                        </div>
                        <div class="text-4xl">üõ°Ô∏è</div>
                    </div>
                </div>

                <!-- Privacy Level -->
                <div class="bg-gray-800 rounded-lg p-4 shadow-lg">
                    <div class="flex items-center justify-between">
                        <div>
                            <div class="text-sm text-gray-400">Privacy</div>
                            <div
                                id="privacy-level"
                                class="text-xl font-bold text-purple-500"
                            >
                                PSEUDONYMOUS
                            </div>
                        </div>
                        <div class="text-4xl">üîí</div>
                    </div>
                </div>
            </div>

            <!-- Main Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Left Column: Control Panel -->
                <div class="space-y-6">
                    <!-- Connection Control -->
                    <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                        <h2 class="text-xl font-bold mb-4">
                            üì° Connection Control
                        </h2>
                        <div class="space-y-3">
                            <button
                                onclick="connect()"
                                class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-4 rounded-lg transition"
                            >
                                Connect
                            </button>
                            <button
                                onclick="disconnect()"
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition"
                            >
                                Disconnect
                            </button>
                            <button
                                onclick="sendData('NORMAL')"
                                id="send-btn"
                                disabled
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                Send Data
                            </button>
                        </div>
                    </div>

                    <!-- Battery Simulation -->
                    <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                        <h2 class="text-xl font-bold mb-4">
                            üîã Battery Simulation
                        </h2>
                        <input
                            type="range"
                            id="battery-slider"
                            min="0"
                            max="100"
                            value="100"
                            onchange="updateBattery(this.value)"
                            class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"
                        />
                        <div class="mt-2 text-center text-sm text-gray-400">
                            Drag to simulate battery drain
                        </div>
                    </div>

                    <!-- Demo Scenarios -->
                    <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                        <h2 class="text-xl font-bold mb-4">
                            üé¨ Demo Scenarios
                        </h2>
                        <div class="space-y-2">
                            <button
                                onclick="runScenario('normal_nav')"
                                class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition text-sm"
                            >
                                üß≠ Normal Navigation
                            </button>
                            <button
                                onclick="runScenario('battery_drain')"
                                class="w-full bg-orange-600 hover:bg-orange-700 text-white font-semibold py-2 px-4 rounded transition text-sm"
                            >
                                üîã Battery Drain
                            </button>
                            <button
                                onclick="runScenario('critical_alert')"
                                class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition text-sm"
                            >
                                üö® Critical Alert
                            </button>
                            <button
                                onclick="runScenario('privacy_demo')"
                                class="w-full bg-purple-600 hover:bg-purple-700 text-white font-semibold py-2 px-4 rounded transition text-sm"
                            >
                                üîí Privacy Demo
                            </button>
                        </div>
                    </div>

                    <!-- Message Stats -->
                    <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                        <h2 class="text-xl font-bold mb-4">üìä Statistics</h2>
                        <div class="space-y-2">
                            <div class="flex justify-between">
                                <span class="text-gray-400"
                                    >Messages Sent:</span
                                >
                                <span id="msg-sent" class="font-bold">0</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-400"
                                    >Messages Received:</span
                                >
                                <span id="msg-received" class="font-bold"
                                    >0</span
                                >
                            </div>
                        </div>
                    </div>

                    <!-- Interception Control -->
                    <div
                        class="bg-gray-800 rounded-lg p-6 shadow-lg border-2 border-red-500"
                    >
                        <h2 class="text-xl font-bold mb-4">üïµÔ∏è Security Demo</h2>
                        <p class="text-sm text-gray-400 mb-4">
                            Simulate attacker intercepting traffic
                        </p>
                        <button
                            onclick="toggleInterception()"
                            id="interception-btn"
                            class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition"
                        >
                            üö® Start Interception
                        </button>
                        <div
                            id="interception-status"
                            class="mt-3 text-center text-sm text-gray-400"
                        >
                            Interception: OFF
                        </div>
                    </div>
                </div>

                <!-- Center Column: Protocol Visualization -->
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h2 class="text-xl font-bold mb-6">
                        üîÑ Protocol Visualization
                    </h2>

                    <div class="relative h-96" id="visualization-area">
                        <!-- Client Node -->
                        <div
                            class="absolute left-0 top-1/2 transform -translate-y-1/2"
                        >
                            <div class="flex flex-col items-center">
                                <div
                                    id="client-node"
                                    class="w-24 h-24 bg-blue-600 rounded-full flex items-center justify-center text-3xl shadow-lg"
                                >
                                    üì±
                                </div>
                                <div class="mt-2 text-sm font-semibold">
                                    Smart Cane
                                </div>
                                <div class="text-xs text-gray-400">Client</div>
                            </div>
                        </div>

                        <!-- Communication Line -->
                        <div
                            class="absolute left-1/2 top-1/2 transform -translate-x-1/2 -translate-y-1/2 w-px h-24 bg-gray-700"
                        ></div>
                        <div
                            class="absolute left-12 right-12 top-1/2 transform -translate-y-1/2 h-1 bg-gray-700 rounded"
                        ></div>

                        <!-- Message Animation Area -->
                        <div
                            id="message-area"
                            class="absolute left-16 right-16 top-1/2 transform -translate-y-1/2 h-20"
                        ></div>

                        <!-- Attacker Node (initially hidden) -->
                        <div
                            id="attacker-node"
                            class="absolute left-1/2 bottom-4 transform -translate-x-1/2"
                            style="display: none"
                        >
                            <div class="flex flex-col items-center">
                                <div
                                    class="w-16 h-16 bg-red-600 rounded-full flex items-center justify-center text-2xl shadow-lg border-2 border-red-400 pulse-animation"
                                >
                                    üïµÔ∏è
                                </div>
                                <div
                                    class="mt-1 text-xs font-semibold text-red-400"
                                >
                                    Attacker
                                </div>
                                <div class="text-xs text-gray-500">
                                    Intercepting...
                                </div>
                            </div>
                        </div>

                        <!-- Server Node -->
                        <div
                            class="absolute right-0 top-1/2 transform -translate-y-1/2"
                        >
                            <div class="flex flex-col items-center">
                                <div
                                    id="server-node"
                                    class="w-24 h-24 bg-green-600 rounded-full flex items-center justify-center text-3xl shadow-lg"
                                >
                                    üñ•Ô∏è
                                </div>
                                <div class="mt-2 text-sm font-semibold">
                                    SATP Server
                                </div>
                                <div class="text-xs text-gray-400">Server</div>
                            </div>
                        </div>
                    </div>

                    <!-- Security Level Legend -->
                    <div class="mt-6 p-4 bg-gray-700 rounded-lg">
                        <h3 class="text-sm font-semibold mb-2">
                            Security Levels:
                        </h3>
                        <div class="grid grid-cols-2 gap-2 text-xs">
                            <div class="flex items-center">
                                <div
                                    class="w-3 h-3 bg-green-500 rounded mr-2"
                                ></div>
                                <span>MAXIMUM</span>
                            </div>
                            <div class="flex items-center">
                                <div
                                    class="w-3 h-3 bg-blue-500 rounded mr-2"
                                ></div>
                                <span>BALANCED</span>
                            </div>
                            <div class="flex items-center">
                                <div
                                    class="w-3 h-3 bg-orange-500 rounded mr-2"
                                ></div>
                                <span>MINIMAL</span>
                            </div>
                            <div class="flex items-center">
                                <div
                                    class="w-3 h-3 bg-red-500 rounded mr-2"
                                ></div>
                                <span>EMERGENCY</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Event Log -->
                <div class="bg-gray-800 rounded-lg p-6 shadow-lg">
                    <h2 class="text-xl font-bold mb-4">üìã Protocol Events</h2>
                    <div
                        id="event-log"
                        class="space-y-2 max-h-[600px] overflow-y-auto"
                    >
                        <div class="text-sm text-gray-400 text-center py-8">
                            No events yet. Connect to start monitoring.
                        </div>
                    </div>
                </div>

                <!-- Fourth Column: Intercepted Packets -->
                <div
                    class="bg-gray-800 rounded-lg p-6 shadow-lg border-2 border-red-500"
                >
                    <h2 class="text-xl font-bold mb-4 text-red-400">
                        üïµÔ∏è Intercepted Packets
                    </h2>
                    <p class="text-xs text-gray-400 mb-4">
                        What the attacker sees (encrypted data)
                    </p>
                    <div
                        id="intercepted-packets"
                        class="space-y-3 max-h-[600px] overflow-y-auto"
                    >
                        <div class="text-sm text-gray-400 text-center py-8">
                            No packets intercepted yet.<br />
                            Enable interception mode to start.
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer
            class="mt-12 py-6 bg-gray-800 text-center text-sm text-gray-400"
        >
            <p>SATP Protocol Research Project | Astana IT University | 2025</p>
            <p class="mt-1">Research Methods and Tools - MIIL 3222</p>
        </footer>

        <script>
            // WebSocket connection
            const socket = io();

            // State
            let isConnected = false;

            // Socket event handlers
            socket.on("connect", () => {
                console.log("Connected to server");
            });

            socket.on("initial_state", (state) => {
                updateUIFromState(state);
            });

            socket.on("protocol_event", (event) => {
                addEventToLog(event);
            });

            socket.on("message_animation", (data) => {
                animateMessage(data);
            });

            socket.on("connection_status", (data) => {
                updateConnectionStatus(data.status);
            });

            socket.on("battery_update", (data) => {
                updateBatteryUI(data.level);
                updateSecurityUI(data.security_level);
            });

            socket.on("security_change", (data) => {
                updateSecurityUI(data.new_level);
            });

            socket.on("privacy_update", (data) => {
                updatePrivacyUI(data.level);
            });

            socket.on("stats_update", (data) => {
                if (data.messages_sent !== undefined) {
                    document.getElementById("msg-sent").textContent =
                        data.messages_sent;
                }
                if (data.messages_received !== undefined) {
                    document.getElementById("msg-received").textContent =
                        data.messages_received;
                }
            });

            socket.on("data_received", (data) => {
                // Update UI when data payload is received
                console.log("Data received:", data.payload);
            });

            socket.on("interception_status", (data) => {
                updateInterceptionUI(data.active);
            });

            socket.on("packet_intercepted", (data) => {
                addInterceptedPacket(data);
            });

            // API Functions
            async function connect() {
                const response = await fetch("/api/connect", {
                    method: "POST",
                });
                if (response.ok) {
                    updateConnectionStatus("initiating");
                }
            }

            async function disconnect() {
                const response = await fetch("/api/disconnect", {
                    method: "POST",
                });
                if (response.ok) {
                    updateConnectionStatus("disconnected");
                }
            }

            async function sendData(priority = "NORMAL") {
                if (!isConnected) return;

                const response = await fetch("/api/send_data", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ priority }),
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById("msg-sent").textContent =
                        data.messages_sent;
                }
            }

            async function updateBattery(level) {
                const response = await fetch("/api/battery", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ level: parseInt(level) }),
                });
            }

            async function runScenario(scenarioName) {
                if (!isConnected && scenarioName !== "normal_nav") {
                    alert("Please connect first!");
                    return;
                }

                // Auto-connect if not connected
                if (!isConnected) {
                    await connect();
                    await new Promise((resolve) => setTimeout(resolve, 2000));
                }

                const response = await fetch(`/api/scenario/${scenarioName}`, {
                    method: "POST",
                });
            }

            // UI Update Functions
            function updateConnectionStatus(status) {
                const statusEl = document.getElementById("connection-status");
                const iconEl = document.getElementById("connection-icon");
                const sendBtn = document.getElementById("send-btn");
                const clientNode = document.getElementById("client-node");
                const serverNode = document.getElementById("server-node");

                if (status === "connected") {
                    statusEl.textContent = "Connected";
                    statusEl.className = "text-xl font-bold text-green-500";
                    iconEl.className =
                        "w-12 h-12 bg-green-500 rounded-full pulse-animation";
                    sendBtn.disabled = false;
                    isConnected = true;
                    clientNode.classList.add("pulse-animation");
                    serverNode.classList.add("pulse-animation");
                } else if (
                    status === "initiating" ||
                    status === "handshaking"
                ) {
                    statusEl.textContent =
                        status.charAt(0).toUpperCase() + status.slice(1);
                    statusEl.className = "text-xl font-bold text-yellow-500";
                    iconEl.className =
                        "w-12 h-12 bg-yellow-500 rounded-full pulse-animation";
                    sendBtn.disabled = true;
                    isConnected = false;
                } else {
                    statusEl.textContent = "Disconnected";
                    statusEl.className = "text-xl font-bold text-red-500";
                    iconEl.className = "w-12 h-12 bg-red-500 rounded-full";
                    sendBtn.disabled = true;
                    isConnected = false;
                    clientNode.classList.remove("pulse-animation");
                    serverNode.classList.remove("pulse-animation");
                }
            }

            function updateBatteryUI(level) {
                document.getElementById("battery-level").textContent =
                    level + "%";
                document.getElementById("battery-slider").value = level;

                const batteryBar = document.getElementById("battery-bar");
                batteryBar.style.width = level + "%";

                if (level > 70) {
                    batteryBar.className =
                        "bg-green-500 h-full transition-all duration-500";
                } else if (level > 30) {
                    batteryBar.className =
                        "bg-blue-500 h-full transition-all duration-500";
                } else if (level > 10) {
                    batteryBar.className =
                        "bg-orange-500 h-full transition-all duration-500";
                } else {
                    batteryBar.className =
                        "bg-red-500 h-full transition-all duration-500";
                }
            }

            function updateSecurityUI(level) {
                const securityEl = document.getElementById("security-level");
                securityEl.textContent = level;

                const colors = {
                    MAXIMUM: "text-green-500",
                    BALANCED: "text-blue-500",
                    MINIMAL: "text-orange-500",
                    EMERGENCY: "text-red-500",
                };

                securityEl.className =
                    "text-xl font-bold " + (colors[level] || "text-gray-500");
            }

            function updatePrivacyUI(level) {
                const privacyEl = document.getElementById("privacy-level");
                privacyEl.textContent = level;
            }

            function animateMessage(data) {
                const messageArea = document.getElementById("message-area");
                const packet = document.createElement("div");

                packet.className =
                    "message-packet " +
                    (data.direction === "client_to_server"
                        ? "message-fly-right"
                        : "message-fly-left");
                packet.style.backgroundColor = data.color;
                packet.style.left =
                    data.direction === "client_to_server" ? "0" : "auto";
                packet.style.right =
                    data.direction === "server_to_client" ? "0" : "auto";
                packet.textContent = data.type.substring(0, 4);

                messageArea.appendChild(packet);

                setTimeout(() => {
                    packet.remove();
                }, 1500);
            }

            function addEventToLog(event) {
                const eventLog = document.getElementById("event-log");

                // Remove placeholder if exists
                if (eventLog.querySelector(".text-center")) {
                    eventLog.innerHTML = "";
                }

                const eventItem = document.createElement("div");
                eventItem.className =
                    "event-item p-3 bg-gray-700 rounded text-sm " +
                    (event.is_critical ? "border-l-4 border-red-500" : "");

                eventItem.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <span class="font-semibold text-gray-300">[${event.type}]</span>
                        <span class="ml-2">${event.description}</span>
                    </div>
                    <div class="text-xs text-gray-400 ml-2">${event.timestamp}</div>
                </div>
            `;

                eventLog.insertBefore(eventItem, eventLog.firstChild);

                // Keep only last 50 events
                while (eventLog.children.length > 50) {
                    eventLog.removeChild(eventLog.lastChild);
                }
            }

            function updateUIFromState(state) {
                updateConnectionStatus(state.connection_status);
                updateBatteryUI(state.battery_level);
                updateSecurityUI(state.security_level);
                updatePrivacyUI(state.privacy_level);
                document.getElementById("msg-sent").textContent =
                    state.messages_sent;
                document.getElementById("msg-received").textContent =
                    state.messages_received;

                // Add existing events
                state.events.forEach((event) => addEventToLog(event));

                // Update interception state
                if (state.interception_mode) {
                    updateInterceptionUI(true);
                }
            }

            // Interception Functions
            async function toggleInterception() {
                const response = await fetch("/api/interception/toggle", {
                    method: "POST",
                });

                if (response.ok) {
                    const data = await response.json();
                    updateInterceptionUI(data.interception_mode);
                }
            }

            function updateInterceptionUI(active) {
                const btn = document.getElementById("interception-btn");
                const status = document.getElementById("interception-status");
                const attackerNode = document.getElementById("attacker-node");

                if (active) {
                    btn.textContent = "üõë Stop Interception";
                    btn.className =
                        "w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition";
                    status.textContent = "Interception: ON";
                    status.className =
                        "mt-3 text-center text-sm font-bold text-red-400";
                    attackerNode.style.display = "block";
                } else {
                    btn.textContent = "üö® Start Interception";
                    btn.className =
                        "w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition";
                    status.textContent = "Interception: OFF";
                    status.className = "mt-3 text-center text-sm text-gray-400";
                    attackerNode.style.display = "none";
                }
            }

            function addInterceptedPacket(data) {
                const packetsContainer = document.getElementById(
                    "intercepted-packets",
                );

                // Remove placeholder if exists
                if (packetsContainer.querySelector(".text-center")) {
                    packetsContainer.innerHTML = "";
                }

                const packetEl = document.createElement("div");
                packetEl.className =
                    "bg-gray-900 rounded-lg p-3 border border-red-500 text-xs";

                // Truncate encrypted data for display
                const encryptedPreview =
                    data.encrypted.substring(0, 64) + "...";

                packetEl.innerHTML = `
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-red-400">Intercepted</span>
                        <span class="text-gray-500">${data.timestamp}</span>
                    </div>
                    <div class="mb-2">
                        <div class="text-gray-400 mb-1">Encrypted (what attacker sees):</div>
                        <div class="font-mono text-red-300 bg-black p-2 rounded break-all">
                            ${encryptedPreview}
                        </div>
                    </div>
                    <div class="mb-2">
                        <div class="text-gray-400 mb-1">Actual content (requires key):</div>
                        <div class="font-mono text-green-300 bg-black p-2 rounded break-all blur-sm hover:blur-none transition">
                            ${data.decrypted}
                        </div>
                        <div class="text-xs text-gray-500 mt-1">‚Üë Hover to reveal (attacker cannot do this without key)</div>
                    </div>
                    <div class="text-xs text-gray-500">
                        Security: <span class="text-blue-400">${data.security_level}</span>
                    </div>
                `;

                packetsContainer.insertBefore(
                    packetEl,
                    packetsContainer.firstChild,
                );

                // Keep only last 10 packets
                while (packetsContainer.children.length > 10) {
                    packetsContainer.removeChild(packetsContainer.lastChild);
                }
            }
        </script>
    </body>
</html>
